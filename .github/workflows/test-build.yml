name: Test Build

on:
    push:
        branches:
            - master
    workflow_dispatch:

env:
  msbuild-dir: 'C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Current\Bin'

jobs:
    build:
        name: Test Build
        runs-on: self-hosted

        steps:
            - name: checkout the repository
              uses: actions/checkout@v4

            - name: check NPM version
              run: npm --version

            - name: check msbuild version
              run: |
                  & "${{ env.msbuild-dir }}\msbuild.exe" --version

            - name: edit the file
              run: |
                  $filePath = "C:\Program Files (x86)\MSBuild\14.0\Microsoft.Common.Targets\ImportAfter\test.targets"
                  $oldLine = "line 2"
                  $newLine = "line changed"
                  (Get-Content $filePath) -replace $oldLine, $newLine | Set-Content $filePath

            - name: Delete all files
              # shell: cmd
              # run: rmdir /Q /S ${{ github.workspace }}
              run: Remove-Item ${{ github.workspace }} -Recurse -Force -ErrorAction SilentlyContinue
